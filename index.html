<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockTracker — Real-Time Market Intelligence</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        :root {
            --bg-primary: #06060b;
            --bg-secondary: rgba(15, 15, 25, 0.6);
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.06);
            --glass-strong: rgba(255, 255, 255, 0.05);
            --glass-border-strong: rgba(255, 255, 255, 0.1);
            --glass-hover: rgba(255, 255, 255, 0.07);
            --text-primary: #f0f0f5;
            --text-secondary: #a0a3b8;
            --text-muted: #5d6079;
            --accent: #7c5cfc;
            --accent-light: #a78bfa;
            --accent-glow: rgba(124, 92, 252, 0.25);
            --accent-subtle: rgba(124, 92, 252, 0.08);
            --green: #34d399;
            --green-soft: rgba(52, 211, 153, 0.12);
            --green-glow: rgba(52, 211, 153, 0.3);
            --red: #f87171;
            --red-soft: rgba(248, 113, 113, 0.12);
            --red-glow: rgba(248, 113, 113, 0.3);
            --yellow: #fbbf24;
            --yellow-soft: rgba(251, 191, 36, 0.1);
            --blue: #60a5fa;
            --radius: 16px;
            --radius-sm: 10px;
            --radius-lg: 24px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ===== Animated Background ===== */
        .bg-mesh {
            position: fixed;
            inset: 0;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .bg-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.35;
            animation: float 20s ease-in-out infinite;
        }

        .bg-orb:nth-child(1) {
            width: 600px; height: 600px;
            background: radial-gradient(circle, #7c5cfc 0%, transparent 70%);
            top: -10%; left: -5%;
            animation-duration: 25s;
        }

        .bg-orb:nth-child(2) {
            width: 500px; height: 500px;
            background: radial-gradient(circle, #3b82f6 0%, transparent 70%);
            top: 40%; right: -10%;
            animation-duration: 30s;
            animation-delay: -5s;
        }

        .bg-orb:nth-child(3) {
            width: 400px; height: 400px;
            background: radial-gradient(circle, #8b5cf6 0%, transparent 70%);
            bottom: -5%; left: 30%;
            animation-duration: 22s;
            animation-delay: -10s;
        }

        .bg-orb:nth-child(4) {
            width: 300px; height: 300px;
            background: radial-gradient(circle, #06b6d4 0%, transparent 70%);
            top: 20%; left: 50%;
            animation-duration: 28s;
            animation-delay: -15s;
            opacity: 0.2;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(40px, -30px) scale(1.05); }
            50% { transform: translate(-20px, 40px) scale(0.95); }
            75% { transform: translate(30px, 20px) scale(1.02); }
        }

        .bg-grid {
            position: fixed;
            inset: 0;
            z-index: 0;
            background-image:
                linear-gradient(rgba(255,255,255,0.015) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.015) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
        }

        .bg-noise {
            position: fixed;
            inset: 0;
            z-index: 0;
            opacity: 0.025;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            pointer-events: none;
        }

        /* ===== Glass Utility ===== */
        .glass {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .glass-strong {
            background: var(--glass-strong);
            border: 1px solid var(--glass-border-strong);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
        }

        /* ===== Header ===== */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 0 32px;
            height: 72px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(6, 6, 11, 0.65);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            backdrop-filter: blur(30px) saturate(1.4);
            -webkit-backdrop-filter: blur(30px) saturate(1.4);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.3px;
            flex-shrink: 0;
        }

        .logo-mark {
            width: 36px; height: 36px;
            background: linear-gradient(135deg, var(--accent), #a78bfa, #06b6d4);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .logo-mark::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,0.25));
            border-radius: inherit;
        }

        .logo-mark svg { position: relative; z-index: 1; }

        .logo span em {
            font-style: normal;
            background: linear-gradient(135deg, var(--accent-light), #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Search */
        .search-container {
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 520px;
            flex: 1;
            margin: 0 40px;
        }

        .search-wrapper {
            position: relative;
            flex: 1;
        }

        .search-icon-el {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
            transition: color 0.2s;
        }

        #searchInput {
            width: 100%;
            padding: 11px 18px 11px 46px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 14px;
            font-weight: 400;
            outline: none;
            transition: all 0.25s ease;
        }

        #searchInput:focus {
            background: rgba(255,255,255,0.06);
            border-color: rgba(124, 92, 252, 0.4);
            box-shadow: 0 0 0 4px rgba(124, 92, 252, 0.1), 0 4px 20px rgba(124, 92, 252, 0.08);
        }

        #searchInput:focus ~ .search-icon-el { color: var(--accent-light); }

        #searchInput::placeholder {
            color: var(--text-muted);
            font-weight: 400;
        }

        #searchBtn {
            padding: 11px 24px;
            background: linear-gradient(135deg, var(--accent), #6d5cfc);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        #searchBtn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent, rgba(255,255,255,0.1));
            opacity: 0;
            transition: opacity 0.25s;
        }

        #searchBtn:hover::before { opacity: 1; }
        #searchBtn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 24px rgba(124, 92, 252, 0.3);
        }
        #searchBtn:active { transform: translateY(0); }
        #searchBtn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-shrink: 0;
        }

        .timestamp-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 20px;
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .live-dot {
            width: 6px; height: 6px;
            background: var(--green);
            border-radius: 50%;
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 var(--green-glow); }
            50% { opacity: 0.7; box-shadow: 0 0 0 6px transparent; }
        }

        /* ===== Main ===== */
        main {
            position: relative;
            z-index: 1;
            max-width: 1320px;
            margin: 0 auto;
            padding: 32px;
        }

        /* ===== WELCOME / HOME SCREEN ===== */
        .welcome {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 200px);
            text-align: center;
            gap: 0;
            padding-top: 40px;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 20px;
            background: var(--accent-subtle);
            border: 1px solid rgba(124, 92, 252, 0.2);
            border-radius: 100px;
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 28px;
            animation: fadeInUp 0.6s ease-out;
        }

        .hero-badge .badge-dot {
            width: 6px; height: 6px;
            background: var(--accent-light);
            border-radius: 50%;
            animation: pulse-dot 2s ease-in-out infinite;
        }

        .welcome h1 {
            font-size: clamp(40px, 6vw, 72px);
            font-weight: 800;
            letter-spacing: -2px;
            line-height: 1.05;
            margin-bottom: 20px;
            animation: fadeInUp 0.6s ease-out 0.1s both;
        }

        .welcome h1 .gradient-text {
            background: linear-gradient(135deg, var(--accent-light) 0%, #06b6d4 50%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% auto;
            animation: shimmer 4s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% center; }
            50% { background-position: 100% center; }
        }

        .welcome .subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            max-width: 560px;
            font-weight: 400;
            line-height: 1.7;
            margin-bottom: 40px;
            animation: fadeInUp 0.6s ease-out 0.2s both;
        }

        /* Hero Search */
        .hero-search {
            display: flex;
            align-items: center;
            gap: 0;
            width: 100%;
            max-width: 580px;
            margin-bottom: 48px;
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        .hero-search-wrapper {
            position: relative;
            flex: 1;
        }

        .hero-search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
            transition: color 0.25s;
        }

        .hero-search-input {
            width: 100%;
            padding: 18px 24px 18px 54px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: var(--radius) 0 0 var(--radius);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 16px;
            font-weight: 400;
            outline: none;
            transition: all 0.25s ease;
        }

        .hero-search-input:focus {
            background: rgba(255,255,255,0.06);
            border-color: rgba(124, 92, 252, 0.4);
            box-shadow: 0 0 0 4px rgba(124, 92, 252, 0.08);
        }

        .hero-search-input:focus ~ .hero-search-icon { color: var(--accent-light); }

        .hero-search-input::placeholder { color: var(--text-muted); }

        .hero-search-btn {
            padding: 18px 32px;
            background: linear-gradient(135deg, var(--accent), #6d5cfc);
            color: white;
            border: 1px solid rgba(124,92,252,0.3);
            border-left: none;
            border-radius: 0 var(--radius) var(--radius) 0;
            font-family: inherit;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hero-search-btn:hover {
            box-shadow: 0 8px 32px rgba(124,92,252,0.3);
        }

        /* Trending Section */
        .trending-section {
            animation: fadeInUp 0.6s ease-out 0.4s both;
            margin-bottom: 56px;
            width: 100%;
            max-width: 700px;
        }

        .trending-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 14px;
        }

        .trending-chips {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .trend-chip {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 18px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.25s ease;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .trend-chip:hover {
            background: rgba(255,255,255,0.07);
            border-color: rgba(124,92,252,0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }

        .trend-chip .chip-symbol {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .trend-chip .chip-name {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 400;
        }

        .trend-chip .chip-divider {
            width: 1px;
            height: 20px;
            background: rgba(255,255,255,0.08);
        }

        /* Feature Cards */
        .features-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            width: 100%;
            max-width: 800px;
            animation: fadeInUp 0.6s ease-out 0.5s both;
        }

        .feature-card {
            padding: 24px 20px;
            background: rgba(255,255,255,0.025);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: var(--radius);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            text-align: left;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            background: rgba(255,255,255,0.04);
            border-color: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .feature-icon {
            width: 40px; height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 14px;
            font-size: 18px;
        }

        .feature-icon.purple { background: var(--accent-subtle); }
        .feature-icon.blue { background: rgba(96,165,250,0.1); }
        .feature-icon.teal { background: rgba(52,211,153,0.1); }

        .feature-card h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .feature-card p {
            font-size: 12px;
            color: var(--text-muted);
            line-height: 1.6;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== Loading ===== */
        .loading-state {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50vh;
            gap: 20px;
        }

        .loader {
            width: 48px; height: 48px;
            position: relative;
        }

        .loader::before, .loader::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            border: 3px solid transparent;
        }

        .loader::before {
            border-top-color: var(--accent);
            animation: spin 0.9s linear infinite;
        }

        .loader::after {
            border-bottom-color: var(--accent-light);
            animation: spin 0.9s linear infinite reverse;
            inset: 6px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-state p {
            color: var(--text-secondary);
            font-size: 15px;
            font-weight: 500;
        }

        /* ===== Error ===== */
        .error-state {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50vh;
            gap: 16px;
            text-align: center;
        }

        .error-glass {
            padding: 40px 48px;
            background: rgba(248,113,113,0.04);
            border: 1px solid rgba(248,113,113,0.12);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .error-glass .error-icon-circle {
            width: 56px; height: 56px;
            background: rgba(248,113,113,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
        }

        .error-glass h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .error-glass p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* ===== Stock Content ===== */
        #stockContent {
            display: none;
            animation: fadeInUp 0.5s ease-out;
        }

        /* Price Hero */
        .price-hero {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: 28px 32px;
            background: rgba(255,255,255,0.025);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            margin-bottom: 24px;
            gap: 24px;
            flex-wrap: wrap;
            position: relative;
            overflow: hidden;
        }

        .price-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(124,92,252,0.3), transparent);
        }

        .price-hero-left {
            flex: 1;
            min-width: 280px;
        }

        .stock-identity {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 16px;
        }

        .stock-logo-placeholder {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, var(--accent-subtle), rgba(96,165,250,0.1));
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 800;
            color: var(--accent-light);
        }

        .stock-name-group h1 {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .stock-symbol-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
        }

        .stock-symbol-tag .sym {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            background: rgba(255,255,255,0.04);
            padding: 2px 10px;
            border-radius: 6px;
        }

        .stock-meta-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .stock-meta-tags .meta-tag {
            font-size: 11px;
            font-weight: 500;
            color: var(--text-muted);
            padding: 2px 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.03);
        }

        .price-main-row {
            display: flex;
            align-items: baseline;
            gap: 16px;
            flex-wrap: wrap;
        }

        .big-price {
            font-size: 48px;
            font-weight: 800;
            letter-spacing: -2px;
            line-height: 1;
        }

        .price-change-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 15px;
            font-weight: 700;
        }

        .price-change-pill.up {
            background: var(--green-soft);
            color: var(--green);
        }

        .price-change-pill.down {
            background: var(--red-soft);
            color: var(--red);
        }

        .price-change-pill svg { flex-shrink: 0; }

        .price-currency-label {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* Right side stats mini-cards */
        .price-hero-right {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            min-width: 280px;
        }

        .mini-stat {
            padding: 14px 16px;
            background: rgba(255,255,255,0.025);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: var(--radius-sm);
        }

        .mini-stat-label {
            font-size: 11px;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .mini-stat-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .mini-stat-sub {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* Recommendation */
        .rec-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 20px;
            border-radius: 100px;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .rec-badge.buy {
            background: var(--green-soft);
            color: var(--green);
            border: 1px solid rgba(52,211,153,0.2);
        }

        .rec-badge.hold {
            background: var(--yellow-soft);
            color: var(--yellow);
            border: 1px solid rgba(251,191,36,0.2);
        }

        .rec-badge.sell {
            background: var(--red-soft);
            color: var(--red);
            border: 1px solid rgba(248,113,113,0.2);
        }

        .rec-badge .rec-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        /* ===== Chart Card ===== */
        .chart-card {
            background: rgba(255,255,255,0.025);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: var(--radius-lg);
            padding: 24px 28px;
            margin-bottom: 24px;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .chart-title-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-title-group h3 {
            font-size: 16px;
            font-weight: 700;
        }

        .chart-title-group .chart-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }

        .period-tabs {
            display: flex;
            gap: 2px;
            background: rgba(255,255,255,0.03);
            padding: 3px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .period-tab {
            padding: 7px 14px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-family: inherit;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .period-tab:hover { color: var(--text-primary); background: rgba(255,255,255,0.03); }

        .period-tab.active {
            background: linear-gradient(135deg, var(--accent), #6d5cfc);
            color: white;
            box-shadow: 0 2px 12px rgba(124,92,252,0.3);
        }

        .chart-container {
            position: relative;
            height: 340px;
        }

        /* ===== Section Headers ===== */
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 18px;
            margin-top: 12px;
        }

        .section-header-icon {
            width: 32px; height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
        }

        .section-header-icon.purple { background: var(--accent-subtle); }
        .section-header-icon.blue { background: rgba(96,165,250,0.1); }
        .section-header-icon.teal { background: rgba(52,211,153,0.1); }
        .section-header-icon.amber { background: rgba(251,191,36,0.08); }

        .section-header h3 {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.3px;
        }

        .section-header .section-line {
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, rgba(255,255,255,0.06), transparent);
        }

        /* ===== Cards Grid ===== */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 28px;
        }

        .full-width-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 28px;
        }

        /* Cards */
        .card {
            background: rgba(255,255,255,0.025);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: var(--radius);
            padding: 22px 24px;
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            transition: all 0.3s ease;
        }

        .card:hover {
            background: rgba(255,255,255,0.035);
            border-color: rgba(255,255,255,0.1);
        }

        .card-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 14px;
            border-bottom: 1px solid rgba(255,255,255,0.04);
        }

        .card-title .card-icon {
            width: 28px; height: 28px;
            border-radius: 7px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
        }

        .card-icon.purple { background: var(--accent-subtle); }
        .card-icon.blue { background: rgba(96,165,250,0.1); }
        .card-icon.teal { background: rgba(52,211,153,0.1); }
        .card-icon.amber { background: rgba(251,191,36,0.08); }
        .card-icon.rose { background: rgba(248,113,113,0.08); }

        /* Stat rows */
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            transition: background 0.15s;
        }

        .stat-row:last-child { border-bottom: none; }

        .stat-row:hover {
            background: rgba(255,255,255,0.015);
            margin: 0 -8px;
            padding: 10px 8px;
            border-radius: 6px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .stat-value {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            text-align: right;
            font-variant-numeric: tabular-nums;
        }

        /* 52-week range bar */
        .range-bar-container { margin: 16px 0 8px; }

        .range-track {
            height: 6px;
            background: rgba(255,255,255,0.06);
            border-radius: 3px;
            position: relative;
            margin: 10px 0;
            overflow: visible;
        }

        .range-fill {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, var(--red), var(--yellow), var(--green));
            border-radius: 3px;
            width: 100%;
            opacity: 0.6;
        }

        .range-marker {
            position: absolute;
            top: 50%;
            width: 16px; height: 16px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 0 3px var(--accent), 0 2px 12px rgba(0,0,0,0.4);
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .range-labels .range-current {
            color: var(--text-primary);
            font-weight: 700;
        }

        /* Description */
        .description-card { grid-column: 1 / -1; }

        .description-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.8;
            max-height: 100px;
            overflow: hidden;
            transition: max-height 0.4s ease;
            position: relative;
        }

        .description-text:not(.expanded)::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: linear-gradient(transparent, rgba(6,6,11,0.95));
            pointer-events: none;
        }

        .description-text.expanded { max-height: 2000px; }
        .description-text.expanded::after { display: none; }

        .show-more-btn {
            background: none;
            border: none;
            color: var(--accent-light);
            cursor: pointer;
            font-family: inherit;
            font-size: 13px;
            font-weight: 600;
            margin-top: 12px;
            padding: 0;
            transition: color 0.2s;
        }

        .show-more-btn:hover { color: white; }

        /* ===== Responsive ===== */
        @media (max-width: 900px) {
            header {
                flex-wrap: wrap;
                height: auto;
                padding: 12px 16px;
                gap: 10px;
            }

            .search-container {
                margin: 0;
                max-width: 100%;
                order: 3;
                width: 100%;
            }

            .header-right { display: none; }

            main { padding: 20px 16px; }

            .welcome h1 { font-size: 36px; letter-spacing: -1px; }

            .hero-search {
                flex-direction: column;
                gap: 10px;
            }

            .hero-search-input {
                border-radius: var(--radius);
            }

            .hero-search-btn {
                border-radius: var(--radius);
                border-left: 1px solid rgba(124,92,252,0.3);
                width: 100%;
                justify-content: center;
            }

            .features-row {
                grid-template-columns: 1fr;
            }

            .price-hero {
                flex-direction: column;
                padding: 20px;
            }

            .price-hero-right {
                width: 100%;
            }

            .big-price { font-size: 36px; }

            .full-width-grid { grid-template-columns: 1fr; }

            .cards-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .trending-chips { gap: 6px; }
            .trend-chip { padding: 8px 12px; }
            .price-hero-right { grid-template-columns: 1fr; }
        }

        /* ===== Utility ===== */
        .text-green { color: var(--green); }
        .text-red { color: var(--red); }
        .hidden { display: none !important; }

        /* Smooth page transitions */
        .fade-in { animation: fadeInUp 0.5s ease-out; }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-mesh">
        <div class="bg-orb"></div>
        <div class="bg-orb"></div>
        <div class="bg-orb"></div>
        <div class="bg-orb"></div>
    </div>
    <div class="bg-grid"></div>
    <div class="bg-noise"></div>

    <!-- Header -->
    <header>
        <div class="logo">
            <div class="logo-mark">
                <svg width="18" height="18" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                    <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/>
                    <polyline points="16 7 22 7 22 13"/>
                </svg>
            </div>
            <span>Stock<em>Tracker</em></span>
        </div>

        <div class="search-container">
            <div class="search-wrapper">
                <input type="text" id="searchInput" placeholder="Search symbol (e.g. AAPL, TSLA)..." autocomplete="off" spellcheck="false">
                <svg class="search-icon-el" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                </svg>
            </div>
            <button id="searchBtn">Search</button>
        </div>

        <div class="header-right">
            <div class="timestamp-badge" id="lastUpdated">
                <div class="live-dot"></div>
                <span>Real-time data</span>
            </div>
        </div>
    </header>

    <main>
        <!-- ===== Welcome / Home ===== -->
        <div class="welcome" id="welcomeState">
            <div class="hero-badge">
                <div class="badge-dot"></div>
                Live Market Data
            </div>

            <h1>
                Track stocks in<br><span class="gradient-text">real time</span>
            </h1>

            <p class="subtitle">
                Instant access to live prices, financials, analyst ratings, and company intelligence — no API keys, no sign-up.
            </p>

            <div class="hero-search">
                <div class="hero-search-wrapper">
                    <input type="text" class="hero-search-input" id="heroSearchInput" placeholder="Enter a stock symbol..." autocomplete="off" spellcheck="false">
                    <svg class="hero-search-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                    </svg>
                </div>
                <button class="hero-search-btn" id="heroSearchBtn">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    Search
                </button>
            </div>

            <div class="trending-section">
                <div class="trending-label">Trending Now</div>
                <div class="trending-chips">
                    <div class="trend-chip" onclick="searchStock('AAPL')">
                        <span class="chip-symbol">AAPL</span>
                        <span class="chip-divider"></span>
                        <span class="chip-name">Apple</span>
                    </div>
                    <div class="trend-chip" onclick="searchStock('NVDA')">
                        <span class="chip-symbol">NVDA</span>
                        <span class="chip-divider"></span>
                        <span class="chip-name">NVIDIA</span>
                    </div>
                    <div class="trend-chip" onclick="searchStock('TSLA')">
                        <span class="chip-symbol">TSLA</span>
                        <span class="chip-divider"></span>
                        <span class="chip-name">Tesla</span>
                    </div>
                    <div class="trend-chip" onclick="searchStock('MSFT')">
                        <span class="chip-symbol">MSFT</span>
                        <span class="chip-divider"></span>
                        <span class="chip-name">Microsoft</span>
                    </div>
                    <div class="trend-chip" onclick="searchStock('GOOGL')">
                        <span class="chip-symbol">GOOGL</span>
                        <span class="chip-divider"></span>
                        <span class="chip-name">Alphabet</span>
                    </div>
                    <div class="trend-chip" onclick="searchStock('AMZN')">
                        <span class="chip-symbol">AMZN</span>
                        <span class="chip-divider"></span>
                        <span class="chip-name">Amazon</span>
                    </div>
                    <div class="trend-chip" onclick="searchStock('META')">
                        <span class="chip-symbol">META</span>
                        <span class="chip-divider"></span>
                        <span class="chip-name">Meta</span>
                    </div>
                    <div class="trend-chip" onclick="searchStock('JPM')">
                        <span class="chip-symbol">JPM</span>
                        <span class="chip-divider"></span>
                        <span class="chip-name">JPMorgan</span>
                    </div>
                </div>
            </div>

            <div class="features-row">
                <div class="feature-card">
                    <div class="feature-icon purple">
                        <svg width="18" height="18" fill="none" stroke="#a78bfa" stroke-width="2" viewBox="0 0 24 24"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                    </div>
                    <h4>Live Prices</h4>
                    <p>Real-time stock quotes powered by Yahoo Finance</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon blue">
                        <svg width="18" height="18" fill="none" stroke="#60a5fa" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
                    </div>
                    <h4>Deep Financials</h4>
                    <p>Revenue, margins, P/E ratios, cash flow and more</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon teal">
                        <svg width="18" height="18" fill="none" stroke="#34d399" stroke-width="2" viewBox="0 0 24 24"><path d="M12 20V10M18 20V4M6 20v-4"/></svg>
                    </div>
                    <h4>Analyst Targets</h4>
                    <p>Wall Street price targets and consensus ratings</p>
                </div>
            </div>
        </div>

        <!-- ===== Loading ===== -->
        <div class="loading-state" id="loadingState">
            <div class="loader"></div>
            <p>Fetching real-time market data...</p>
        </div>

        <!-- ===== Error ===== -->
        <div class="error-state" id="errorState">
            <div class="error-glass">
                <div class="error-icon-circle">
                    <svg width="24" height="24" fill="none" stroke="var(--red)" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M15 9l-6 6M9 9l6 6"/></svg>
                </div>
                <h3 id="errorTitle">Symbol Not Found</h3>
                <p id="errorMessage">Could not fetch data for this symbol.</p>
            </div>
        </div>

        <!-- ===== Stock Content ===== -->
        <div id="stockContent">
            <!-- Price Hero -->
            <div class="price-hero">
                <div class="price-hero-left">
                    <div class="stock-identity">
                        <div class="stock-logo-placeholder" id="stockLogoPlaceholder">—</div>
                        <div>
                            <div class="stock-name-group">
                                <h1 id="companyName">—</h1>
                            </div>
                            <div class="stock-symbol-tag">
                                <span class="sym" id="symbolBadge">—</span>
                                <div class="stock-meta-tags" id="companyMeta"></div>
                            </div>
                        </div>
                    </div>
                    <div class="price-main-row">
                        <span class="big-price" id="currentPrice">—</span>
                        <span class="price-change-pill" id="priceChange">—</span>
                        <span class="price-currency-label" id="priceCurrency">USD</span>
                    </div>
                    <div id="recommendationContainer" style="margin-top: 16px;"></div>
                </div>

                <div class="price-hero-right" id="priceHeroRight">
                    <!-- filled by JS -->
                </div>
            </div>

            <!-- Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title-group">
                        <h3>Price Chart</h3>
                        <span class="chart-subtitle" id="chartSubtitle">1 Month</span>
                    </div>
                    <div class="period-tabs" id="periodTabs">
                        <button class="period-tab" data-period="1d" data-interval="5m" data-label="1 Day">1D</button>
                        <button class="period-tab" data-period="5d" data-interval="15m" data-label="5 Days">5D</button>
                        <button class="period-tab active" data-period="1mo" data-interval="1d" data-label="1 Month">1M</button>
                        <button class="period-tab" data-period="3mo" data-interval="1d" data-label="3 Months">3M</button>
                        <button class="period-tab" data-period="6mo" data-interval="1d" data-label="6 Months">6M</button>
                        <button class="period-tab" data-period="1y" data-interval="1d" data-label="1 Year">1Y</button>
                        <button class="period-tab" data-period="5y" data-interval="1wk" data-label="5 Years">5Y</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>

            <!-- Key Stats -->
            <div class="section-header">
                <div class="section-header-icon purple">
                    <svg width="15" height="15" fill="none" stroke="#a78bfa" stroke-width="2" viewBox="0 0 24 24"><path d="M12 20V10M18 20V4M6 20v-4"/></svg>
                </div>
                <h3>Key Statistics</h3>
                <div class="section-line"></div>
            </div>
            <div class="cards-grid" id="keyStatsGrid"></div>

            <!-- Financials -->
            <div class="section-header">
                <div class="section-header-icon teal">
                    <svg width="15" height="15" fill="none" stroke="#34d399" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 3v4M8 3v4M2 11h20"/></svg>
                </div>
                <h3>Financial Performance</h3>
                <div class="section-line"></div>
            </div>
            <div class="full-width-grid" id="financialsGrid"></div>

            <!-- About -->
            <div class="section-header">
                <div class="section-header-icon amber">
                    <svg width="15" height="15" fill="none" stroke="#fbbf24" stroke-width="2" viewBox="0 0 24 24"><path d="M3 21h18M9 8h1M9 12h1M9 16h1M14 8h1M14 12h1M14 16h1M5 21V5a2 2 0 012-2h10a2 2 0 012 2v16"/></svg>
                </div>
                <h3>Company Profile</h3>
                <div class="section-line"></div>
            </div>
            <div class="cards-grid">
                <div class="card description-card" id="aboutCard"></div>
            </div>
        </div>
    </main>

    <script>
    // ===== State =====
    let currentSymbol = '';
    let priceChart = null;

    // ===== DOM =====
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const heroSearchInput = document.getElementById('heroSearchInput');
    const heroSearchBtn = document.getElementById('heroSearchBtn');
    const welcomeState = document.getElementById('welcomeState');
    const loadingState = document.getElementById('loadingState');
    const errorState = document.getElementById('errorState');
    const stockContent = document.getElementById('stockContent');

    // ===== Helpers =====
    function formatNumber(num) {
        if (num === null || num === undefined) return '—';
        if (Math.abs(num) >= 1e12) return (num / 1e12).toFixed(2) + 'T';
        if (Math.abs(num) >= 1e9) return (num / 1e9).toFixed(2) + 'B';
        if (Math.abs(num) >= 1e6) return (num / 1e6).toFixed(2) + 'M';
        if (Math.abs(num) >= 1e3) return num.toLocaleString('en-US');
        return num.toString();
    }

    function formatCurrency(num, currency = 'USD') {
        if (num === null || num === undefined) return '—';
        return new Intl.NumberFormat('en-US', {
            style: 'currency', currency,
            minimumFractionDigits: 2, maximumFractionDigits: 2,
        }).format(num);
    }

    function formatPercent(num) {
        if (num === null || num === undefined) return '—';
        if (Math.abs(num) < 1) num *= 100;
        return num.toFixed(2) + '%';
    }

    function formatRatio(num) {
        if (num === null || num === undefined) return '—';
        return num.toFixed(2);
    }

    function val(v) { return v !== null && v !== undefined; }

    function setState(state) {
        welcomeState.style.display = state === 'welcome' ? 'flex' : 'none';
        loadingState.style.display = state === 'loading' ? 'flex' : 'none';
        errorState.style.display = state === 'error' ? 'flex' : 'none';
        stockContent.style.display = state === 'content' ? 'block' : 'none';
    }

    // ===== Search =====
    function searchStock(symbol) {
        symbol = symbol.trim().toUpperCase();
        if (!symbol) return;
        searchInput.value = symbol;
        heroSearchInput.value = symbol;
        currentSymbol = symbol;
        window.location.hash = symbol;
        fetchStockData(symbol);
    }

    searchBtn.addEventListener('click', () => searchStock(searchInput.value));
    searchInput.addEventListener('keydown', e => { if (e.key === 'Enter') searchStock(searchInput.value); });
    heroSearchBtn.addEventListener('click', () => searchStock(heroSearchInput.value));
    heroSearchInput.addEventListener('keydown', e => { if (e.key === 'Enter') searchStock(heroSearchInput.value); });

    async function fetchStockData(symbol) {
        setState('loading');
        searchBtn.disabled = true;

        try {
            const res = await fetch(`/api/stock/${encodeURIComponent(symbol)}`);
            const data = await res.json();

            if (!res.ok) {
                showError(data.error || 'Failed to fetch data');
                return;
            }

            renderStock(data);
            setState('content');
            fetchChart(symbol, '1mo', '1d');

            // Update timestamp
            const ts = document.getElementById('lastUpdated');
            ts.innerHTML = `<div class="live-dot"></div><span>Updated ${new Date().toLocaleTimeString()}</span>`;

        } catch (err) {
            showError('Network error. Please check your connection.');
        } finally {
            searchBtn.disabled = false;
        }
    }

    function showError(msg) {
        document.getElementById('errorMessage').textContent = msg;
        setState('error');
    }

    // ===== Render Stock =====
    function renderStock(d) {
        const cur = d.price.currency || 'USD';

        // Identity
        const initials = (d.symbol || '??').slice(0, 2);
        document.getElementById('stockLogoPlaceholder').textContent = initials;
        document.getElementById('companyName').textContent = d.name || d.symbol;
        document.getElementById('symbolBadge').textContent = d.symbol;
        document.getElementById('priceCurrency').textContent = cur;

        // Meta tags
        const meta = document.getElementById('companyMeta');
        let metaHTML = '';
        if (d.company.sector) metaHTML += `<span class="meta-tag">${d.company.sector}</span>`;
        if (d.company.industry) metaHTML += `<span class="meta-tag">${d.company.industry}</span>`;
        meta.innerHTML = metaHTML;

        // Price
        const price = d.price.current;
        document.getElementById('currentPrice').textContent = price != null ? formatCurrency(price, cur) : '—';

        const changeEl = document.getElementById('priceChange');
        if (val(d.price.change) && val(d.price.changePercent)) {
            const up = d.price.change >= 0;
            const arrow = up
                ? '<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M18 15l-6-6-6 6"/></svg>'
                : '<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>';
            changeEl.className = 'price-change-pill ' + (up ? 'up' : 'down');
            changeEl.innerHTML = `${arrow} ${up ? '+' : ''}${d.price.change.toFixed(2)} (${up ? '+' : ''}${d.price.changePercent.toFixed(2)}%)`;
        } else {
            changeEl.innerHTML = '';
            changeEl.className = 'price-change-pill';
        }

        // Recommendation
        const recContainer = document.getElementById('recommendationContainer');
        if (d.targets.recommendation) {
            let cls = 'hold';
            if (['buy', 'strong_buy'].includes(d.targets.recommendation)) cls = 'buy';
            else if (['sell', 'strong_sell'].includes(d.targets.recommendation)) cls = 'sell';
            recContainer.innerHTML = `<span class="rec-badge ${cls}"><span class="rec-dot"></span>${d.targets.recommendation.replace('_', ' ')}</span>`;
        } else {
            recContainer.innerHTML = '';
        }

        // Mini stats in hero right
        const heroRight = document.getElementById('priceHeroRight');
        let miniCards = '';
        const miniData = [
            { label: 'Market Cap', value: val(d.marketCap) ? '$' + formatNumber(d.marketCap) : '—' },
            { label: 'Volume', value: val(d.volume.current) ? formatNumber(d.volume.current) : '—', sub: val(d.volume.average) ? 'Avg: ' + formatNumber(d.volume.average) : '' },
            { label: 'P/E Ratio', value: val(d.financials.peRatio) ? formatRatio(d.financials.peRatio) : '—', sub: val(d.financials.forwardPE) ? 'Fwd: ' + formatRatio(d.financials.forwardPE) : '' },
            { label: '52W Range', value: val(d.ranges.fiftyTwoWeekLow) && val(d.ranges.fiftyTwoWeekHigh) ? formatCurrency(d.ranges.fiftyTwoWeekLow, cur) + ' — ' + formatCurrency(d.ranges.fiftyTwoWeekHigh, cur) : '—' },
        ];
        miniData.forEach(m => {
            miniCards += `<div class="mini-stat">
                <div class="mini-stat-label">${m.label}</div>
                <div class="mini-stat-value">${m.value}</div>
                ${m.sub ? `<div class="mini-stat-sub">${m.sub}</div>` : ''}
            </div>`;
        });
        heroRight.innerHTML = miniCards;

        // Sections
        renderKeyStats(d);
        renderFinancials(d);
        renderAbout(d);
    }

    function renderKeyStats(d) {
        const grid = document.getElementById('keyStatsGrid');
        const cur = d.price.currency || 'USD';

        function buildRows(stats) {
            return stats.filter(s => s[1]).map(([l,v]) =>
                `<div class="stat-row"><span class="stat-label">${l}</span><span class="stat-value">${v}</span></div>`
            ).join('');
        }

        const tradingRows = buildRows([
            ['Open', val(d.price.open) ? formatCurrency(d.price.open, cur) : null],
            ['Previous Close', val(d.price.previousClose) ? formatCurrency(d.price.previousClose, cur) : null],
            ['Day High', val(d.price.dayHigh) ? formatCurrency(d.price.dayHigh, cur) : null],
            ['Day Low', val(d.price.dayLow) ? formatCurrency(d.price.dayLow, cur) : null],
            ['Volume', val(d.volume.current) ? formatNumber(d.volume.current) : null],
            ['Avg Volume (10D)', val(d.volume.average10Day) ? formatNumber(d.volume.average10Day) : null],
        ]);

        const valRows = buildRows([
            ['Market Cap', val(d.marketCap) ? '$' + formatNumber(d.marketCap) : null],
            ['P/E Ratio (TTM)', val(d.financials.peRatio) ? formatRatio(d.financials.peRatio) : null],
            ['Forward P/E', val(d.financials.forwardPE) ? formatRatio(d.financials.forwardPE) : null],
            ['PEG Ratio', val(d.financials.pegRatio) ? formatRatio(d.financials.pegRatio) : null],
            ['Price/Book', val(d.financials.priceToBook) ? formatRatio(d.financials.priceToBook) : null],
            ['Price/Sales', val(d.financials.priceToSales) ? formatRatio(d.financials.priceToSales) : null],
            ['EPS (TTM)', val(d.financials.earningsPerShare) ? formatCurrency(d.financials.earningsPerShare, cur) : null],
        ]);

        let rangeHTML = '';
        if (val(d.ranges.fiftyTwoWeekLow) && val(d.ranges.fiftyTwoWeekHigh) && val(d.price.current)) {
            const low = d.ranges.fiftyTwoWeekLow, high = d.ranges.fiftyTwoWeekHigh, c = d.price.current;
            const pct = Math.min(100, Math.max(0, ((c - low) / (high - low)) * 100));
            rangeHTML += `
                <div class="stat-row"><span class="stat-label">52-Week Low</span><span class="stat-value">${formatCurrency(low, cur)}</span></div>
                <div class="stat-row"><span class="stat-label">52-Week High</span><span class="stat-value">${formatCurrency(high, cur)}</span></div>
                <div class="range-bar-container">
                    <div class="range-track"><div class="range-fill"></div><div class="range-marker" style="left:${pct}%"></div></div>
                    <div class="range-labels"><span>${formatCurrency(low, cur)}</span><span class="range-current">${formatCurrency(c, cur)}</span><span>${formatCurrency(high, cur)}</span></div>
                </div>`;
        }
        if (val(d.ranges.fiftyDayAverage)) rangeHTML += `<div class="stat-row"><span class="stat-label">50-Day Avg</span><span class="stat-value">${formatCurrency(d.ranges.fiftyDayAverage, cur)}</span></div>`;
        if (val(d.ranges.twoHundredDayAverage)) rangeHTML += `<div class="stat-row"><span class="stat-label">200-Day Avg</span><span class="stat-value">${formatCurrency(d.ranges.twoHundredDayAverage, cur)}</span></div>`;
        if (val(d.ranges.beta)) rangeHTML += `<div class="stat-row"><span class="stat-label">Beta</span><span class="stat-value">${formatRatio(d.ranges.beta)}</span></div>`;

        let divRows = buildRows([
            ['Dividend Rate', val(d.dividends.dividendRate) ? formatCurrency(d.dividends.dividendRate, cur) : null],
            ['Dividend Yield', val(d.dividends.dividendYield) ? formatPercent(d.dividends.dividendYield) : null],
            ['Payout Ratio', val(d.dividends.payoutRatio) ? formatPercent(d.dividends.payoutRatio) : null],
        ]);

        const empty = '<p style="color:var(--text-muted);font-size:13px;padding:8px 0">No data available</p>';

        grid.innerHTML = `
            <div class="card">
                <div class="card-title"><span class="card-icon purple"><svg width="13" height="13" fill="none" stroke="#a78bfa" stroke-width="2" viewBox="0 0 24 24"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/></svg></span>Trading</div>
                ${tradingRows || empty}
            </div>
            <div class="card">
                <div class="card-title"><span class="card-icon blue"><svg width="13" height="13" fill="none" stroke="#60a5fa" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg></span>Valuation</div>
                ${valRows || empty}
            </div>
            <div class="card">
                <div class="card-title"><span class="card-icon teal"><svg width="13" height="13" fill="none" stroke="#34d399" stroke-width="2" viewBox="0 0 24 24"><path d="M12 20V10M18 20V4M6 20v-4"/></svg></span>Range & Averages</div>
                ${rangeHTML || empty}
            </div>
            ${divRows ? `<div class="card"><div class="card-title"><span class="card-icon amber"><svg width="13" height="13" fill="none" stroke="#fbbf24" stroke-width="2" viewBox="0 0 24 24"><path d="M12 1v22M17 5H9.5a3.5 3.5 0 100 7h5a3.5 3.5 0 110 7H6"/></svg></span>Dividends</div>${divRows}</div>` : ''}
        `;
    }

    function renderFinancials(d) {
        const grid = document.getElementById('financialsGrid');
        const f = d.financials;
        const cur = d.price.currency || 'USD';

        function buildRows(stats) {
            return stats.filter(s => s[1]).map(([l,v]) =>
                `<div class="stat-row"><span class="stat-label">${l}</span><span class="stat-value">${v}</span></div>`
            ).join('');
        }

        const incomeRows = buildRows([
            ['Revenue', val(f.revenue) ? '$' + formatNumber(f.revenue) : null],
            ['Gross Profit', val(f.grossProfit) ? '$' + formatNumber(f.grossProfit) : null],
            ['EBITDA', val(f.ebitda) ? '$' + formatNumber(f.ebitda) : null],
            ['Net Income', val(f.netIncome) ? '$' + formatNumber(f.netIncome) : null],
            ['Revenue/Share', val(f.revenuePerShare) ? formatCurrency(f.revenuePerShare, cur) : null],
            ['Free Cash Flow', val(f.freeCashflow) ? '$' + formatNumber(f.freeCashflow) : null],
            ['Operating Cash Flow', val(f.operatingCashflow) ? '$' + formatNumber(f.operatingCashflow) : null],
        ]);

        const marginRows = buildRows([
            ['Profit Margin', val(f.profitMargin) ? formatPercent(f.profitMargin) : null],
            ['Operating Margin', val(f.operatingMargin) ? formatPercent(f.operatingMargin) : null],
            ['Gross Margin', val(f.grossMargin) ? formatPercent(f.grossMargin) : null],
            ['Return on Equity', val(f.returnOnEquity) ? formatPercent(f.returnOnEquity) : null],
            ['Return on Assets', val(f.returnOnAssets) ? formatPercent(f.returnOnAssets) : null],
            ['Debt/Equity', val(f.debtToEquity) ? formatRatio(f.debtToEquity) : null],
            ['Current Ratio', val(f.currentRatio) ? formatRatio(f.currentRatio) : null],
        ]);

        let targetRows = '';
        if (val(d.targets.targetMean) || val(d.targets.targetHigh)) {
            targetRows = buildRows([
                ['Target High', val(d.targets.targetHigh) ? formatCurrency(d.targets.targetHigh, cur) : null],
                ['Target Mean', val(d.targets.targetMean) ? formatCurrency(d.targets.targetMean, cur) : null],
                ['Target Median', val(d.targets.targetMedian) ? formatCurrency(d.targets.targetMedian, cur) : null],
                ['Target Low', val(d.targets.targetLow) ? formatCurrency(d.targets.targetLow, cur) : null],
                ['# of Analysts', val(d.targets.numberOfAnalysts) ? d.targets.numberOfAnalysts : null],
            ]);
        }

        const empty = '<p style="color:var(--text-muted);font-size:13px;padding:8px 0">No data available</p>';

        grid.innerHTML = `
            <div class="card">
                <div class="card-title"><span class="card-icon teal"><svg width="13" height="13" fill="none" stroke="#34d399" stroke-width="2" viewBox="0 0 24 24"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/></svg></span>Income & Cash Flow</div>
                ${incomeRows || empty}
            </div>
            <div class="card">
                <div class="card-title"><span class="card-icon rose"><svg width="13" height="13" fill="none" stroke="#f87171" stroke-width="2" viewBox="0 0 24 24"><path d="M12 20V10M18 20V4M6 20v-4"/></svg></span>Margins & Ratios</div>
                ${marginRows || empty}
            </div>
            ${targetRows ? `<div class="card" style="grid-column:1/-1">
                <div class="card-title"><span class="card-icon purple"><svg width="13" height="13" fill="none" stroke="#a78bfa" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg></span>Analyst Price Targets</div>
                ${targetRows}
            </div>` : ''}
        `;
    }

    function renderAbout(d) {
        const card = document.getElementById('aboutCard');
        const c = d.company;

        function buildRows(stats) {
            return stats.filter(s => s[1]).map(([l,v]) =>
                `<div class="stat-row"><span class="stat-label">${l}</span><span class="stat-value">${v}</span></div>`
            ).join('');
        }

        let html = `<div class="card-title"><span class="card-icon amber"><svg width="13" height="13" fill="none" stroke="#fbbf24" stroke-width="2" viewBox="0 0 24 24"><path d="M3 21h18M9 8h1M9 12h1M9 16h1M14 8h1M14 12h1M14 16h1M5 21V5a2 2 0 012-2h10a2 2 0 012 2v16"/></svg></span>Overview</div>`;

        const loc = [c.city, c.state, c.country].filter(Boolean).join(', ');
        html += buildRows([
            ['Employees', c.employees ? formatNumber(c.employees) : null],
            ['Sector', c.sector || null],
            ['Industry', c.industry || null],
            ['Headquarters', loc || null],
            ['Website', c.website ? `<a href="${c.website}" target="_blank" rel="noopener" style="color:var(--accent-light);text-decoration:none">${c.website.replace('https://','').replace('http://','')}</a>` : null],
        ]);

        if (c.description) {
            html += `
                <div style="margin-top:18px;border-top:1px solid rgba(255,255,255,0.04);padding-top:18px">
                    <div class="description-text" id="descText">${c.description}</div>
                    <button class="show-more-btn" id="showMoreBtn" onclick="toggleDescription()">Show more</button>
                </div>`;
        }

        card.innerHTML = html;
    }

    function toggleDescription() {
        const t = document.getElementById('descText');
        const b = document.getElementById('showMoreBtn');
        t.classList.toggle('expanded');
        b.textContent = t.classList.contains('expanded') ? 'Show less' : 'Show more';
    }

    // ===== Chart =====
    async function fetchChart(symbol, period, interval) {
        try {
            const res = await fetch(`/api/stock/${encodeURIComponent(symbol)}/history?period=${period}&interval=${interval}`);
            const data = await res.json();
            if (!res.ok) return;
            renderChart(data);
        } catch (err) {
            console.error('Chart error:', err);
        }
    }

    function renderChart(data) {
        const ctx = document.getElementById('priceChart').getContext('2d');
        if (priceChart) priceChart.destroy();

        const labels = data.history.map(h => new Date(h.date));
        const prices = data.history.map(h => h.close);
        const first = prices[0], last = prices[prices.length - 1];
        const isUp = last >= first;
        const lineColor = isUp ? '#34d399' : '#f87171';

        // Gradient fill
        const gradient = ctx.createLinearGradient(0, 0, 0, 340);
        if (isUp) {
            gradient.addColorStop(0, 'rgba(52, 211, 153, 0.15)');
            gradient.addColorStop(1, 'rgba(52, 211, 153, 0.0)');
        } else {
            gradient.addColorStop(0, 'rgba(248, 113, 113, 0.15)');
            gradient.addColorStop(1, 'rgba(248, 113, 113, 0.0)');
        }

        priceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    data: prices,
                    borderColor: lineColor,
                    backgroundColor: gradient,
                    borderWidth: 2,
                    fill: true,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    pointHoverBackgroundColor: lineColor,
                    pointHoverBorderColor: 'white',
                    pointHoverBorderWidth: 2,
                    tension: 0.2,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { intersect: false, mode: 'index' },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(15, 15, 25, 0.95)',
                        titleColor: '#a0a3b8',
                        bodyColor: '#f0f0f5',
                        borderColor: 'rgba(255,255,255,0.08)',
                        borderWidth: 1,
                        padding: 14,
                        cornerRadius: 10,
                        displayColors: false,
                        titleFont: { size: 11, weight: '500' },
                        bodyFont: { size: 14, weight: '700' },
                        callbacks: {
                            title: (items) => new Date(items[0].parsed.x).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' }),
                            label: (item) => '$' + item.parsed.y.toFixed(2),
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'time',
                        grid: { color: 'rgba(255,255,255,0.03)', drawBorder: false },
                        ticks: { color: '#5d6079', maxTicksLimit: 8, font: { size: 11 } },
                    },
                    y: {
                        grid: { color: 'rgba(255,255,255,0.03)', drawBorder: false },
                        ticks: { color: '#5d6079', font: { size: 11 }, callback: v => '$' + v.toFixed(0) },
                    }
                }
            }
        });
    }

    // Period tabs
    document.getElementById('periodTabs').addEventListener('click', e => {
        const tab = e.target.closest('.period-tab');
        if (!tab || !currentSymbol) return;
        document.querySelectorAll('.period-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById('chartSubtitle').textContent = tab.dataset.label || '';
        fetchChart(currentSymbol, tab.dataset.period, tab.dataset.interval);
    });

    // URL hash
    if (window.location.hash) {
        const sym = window.location.hash.slice(1).toUpperCase();
        if (sym) searchStock(sym);
    }
    </script>
</body>
</html>
